Parameters:
  VPCCIDR:
    Type: String
  PublicSubnetCIDR:
    Type: String
  DBSubnetCIDR:
    Type: String
  AvailabilityZone:
    Type: 'AWS::EC2::AvailabilityZone::Name'
Resources:
  IGW:
    Type: 'AWS::EC2::InternetGateway'
    Properties: {}
  VPC:
    Type: 'AWS::EC2::VPC'
    Properties:
      CidrBlock: !Ref VPCCIDR
  GatewayAttach:
    Type: 'AWS::EC2::VPCGatewayAttachment'
    Properties:
      InternetGatewayId: !Ref IGW
      VpcId: !Ref VPC
    DependsOn:
      - VPC
      - IGW
  PublicSubnet:
    Type: 'AWS::EC2::Subnet'
    Properties:
      CidrBlock: !Ref PublicSubnetCIDR
      VpcId: !Ref VPC
      AvailabilityZone: !Ref AvailabilityZone
      MapPublicIpOnLaunch: true
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
  DBSubnet:
    Type: 'AWS::EC2::Subnet'
    Properties:
      CidrBlock: !Ref DBSubnetCIDR
      VpcId: !Ref VPC
      AvailabilityZone: !Ref AvailabilityZone
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
  DBRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
      - DBSubnet
  DBRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref DBSubnet
      RouteTableId: !Ref DBRouteTable
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
      - DBSubnet
      - DBRouteTable
  PublicRouteTable:
    Type: 'AWS::EC2::RouteTable'
    Properties:
      VpcId: !Ref VPC
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
      - PublicSubnet
  PublicRouteTableAssociation:
    Type: 'AWS::EC2::SubnetRouteTableAssociation'
    Properties:
      SubnetId: !Ref PublicSubnet
      RouteTableId: !Ref PublicRouteTable
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
      - DBSubnet
      - PublicRouteTable
  PublicInternetRoute:
    Type: 'AWS::EC2::Route'
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref IGW
    DependsOn:
      - VPC
      - IGW
      - GatewayAttach
      - DBSubnet
      - PublicRouteTable